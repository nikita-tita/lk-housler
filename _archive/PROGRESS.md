# –ü—Ä–æ–≥—Ä–µ—Å—Å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã (lk.housler.ru)

## üéâ BACKEND –ü–û–õ–ù–û–°–¢–¨–Æ –ì–û–¢–û–í (100%)

**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è**: 23 –¥–µ–∫–∞–±—Ä—è 2025

### –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:
- ‚úÖ **24 –º–æ–¥–µ–ª–∏ –ë–î** - –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã —Å PII —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ–º
- ‚úÖ **9 —Å–µ—Ä–≤–∏—Å–æ–≤** - –ø–æ–ª–Ω–∞—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
- ‚úÖ **32+ API endpoints** - –≤—Å–µ endpoints –≥–æ—Ç–æ–≤—ã
- ‚úÖ **3 —Ç–∏–ø–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏** - SMS, Email, Email+Password
- ‚úÖ **PII —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ** - AES-256 + SHA-256 hashes (152-–§–ó)
- ‚úÖ **Housler –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** - SMS.RU, —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –û–û–û "–°–µ–∫—Ç–æ—Ä –ò–¢"
- ‚úÖ **Docker** - dev + production –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- ‚úÖ **Nginx** - –≤–Ω–µ—à–Ω–∏–π —Å–µ—Ä–≤–µ—Ä + internal proxy

**üìã –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥**: —Å–º. [NEXT_STEPS.md](./NEXT_STEPS.md)

---

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ (–¥–µ—Ç–∞–ª–∏)

### 1. –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ –±–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ ‚úÖ
- ‚úÖ Docker Compose (PostgreSQL, Redis, MinIO)
- ‚úÖ FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π
- ‚úÖ Alembic –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–π –ë–î
- ‚úÖ Pydantic Settings –¥–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- ‚úÖ CORS middleware
- ‚úÖ API —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (v1)
- ‚úÖ Dockerfile –¥–ª—è backend

### 2. Database Models (SQLAlchemy) ‚úÖ
- ‚úÖ User, UserProfile, OTPSession
- ‚úÖ Organization, OrganizationMember, PayoutAccount
- ‚úÖ Deal, DealParty, DealTerms
- ‚úÖ Document, ContractTemplate, Signature, AuditLog
- ‚úÖ PaymentSchedule, PaymentIntent, Payment
- ‚úÖ LedgerEntry, Split, Payout
- ‚úÖ Receipt, NPDTask
- ‚úÖ AntiFraudCheck, UserLimit, Blacklist

### 3. Auth & User Service ‚úÖ
- ‚úÖ OTP Service (–≥–µ–Ω–µ—Ä–∞—Ü–∏—è, –æ—Ç–ø—Ä–∞–≤–∫–∞, –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è)
- ‚úÖ SMS Provider (Mock + –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤)
- ‚úÖ JWT —Ç–æ–∫–µ–Ω—ã (access + refresh)
- ‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è/–≤—Ö–æ–¥ —á–µ—Ä–µ–∑ OTP
- ‚úÖ User Service (CRUD –æ–ø–µ—Ä–∞—Ü–∏–π —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏)
- ‚úÖ API endpoints: /auth/otp/send, /auth/otp/verify, /users/me, /users/me/profile

### 4. Organization Service ‚úÖ
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π (–∞–≥–µ–Ω—Ç—Å—Ç–≤–∞, –∑–∞—Å—Ç—Ä–æ–π—â–∏–∫–∏)
- ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏
- ‚úÖ Payout accounts
- ‚úÖ KYC —Å—Ç–∞—Ç—É—Å—ã
- ‚úÖ API endpoints: CRUD –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π, –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤, —Å—á–µ—Ç–∞ –≤—ã–ø–ª–∞—Ç

### 5. Deal Service ‚úÖ
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ —Å–¥–µ–ª–æ–∫ (–ø–æ–∫—É–ø–∫–∞/–ø—Ä–æ–¥–∞–∂–∞ –≤—Ç–æ—Ä–∏—á–∫–∏)
- ‚úÖ Deal Terms (–∫–æ–º–∏—Å—Å–∏—è, –ø–ª–∞–Ω –ø–ª–∞—Ç–µ–∂–µ–π, split rule)
- ‚úÖ Deal Parties (–∫–ª–∏–µ–Ω—Ç, –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å)
- ‚úÖ –°—Ç–∞—Ç—É—Å—ã —Å–¥–µ–ª–æ–∫ (draft ‚Üí awaiting_signatures ‚Üí signed ‚Üí paid ‚Üí closed)
- ‚úÖ API endpoints: CRUD —Å–¥–µ–ª–æ–∫, submit, cancel

### 6. Document Service ‚úÖ
- ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–æ–≥–æ–≤–æ—Ä–æ–≤ –∏–∑ HTML —à–∞–±–ª–æ–Ω–æ–≤
- ‚úÖ –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è HTML ‚Üí PDF (WeasyPrint)
- ‚úÖ SHA-256 —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –ü–≠–ü
- ‚úÖ –•—Ä–∞–Ω–µ–Ω–∏–µ –≤ S3/MinIO
- ‚úÖ –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- ‚úÖ API endpoints: –≥–µ–Ω–µ—Ä–∞—Ü–∏—è, —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ

### 7. Signature Service (–ü–≠–ü) ‚úÖ
- ‚úÖ –ü–≠–ü —á–µ—Ä–µ–∑ SMS OTP (63-–§–ó)
- ‚úÖ Evidence logging (IP, user-agent, timestamp, document hash)
- ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å—è–º–∏ –ø–æ parties
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª–Ω–æ—Ç—ã –ø–æ–¥–ø–∏—Å–µ–π
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å OTP Service

### 8. Payment Service (–°–ë–ü) ‚úÖ
- ‚úÖ Payment Provider –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (Mock –¥–ª—è MVP)
- ‚úÖ Payment Intents (—Å–æ–∑–¥–∞–Ω–∏–µ —Å—Å—ã–ª–æ–∫ –Ω–∞ –æ–ø–ª–∞—Ç—É)
- ‚úÖ Webhook –æ–±—Ä–∞–±–æ—Ç–∫–∞ (idempotency)
- ‚úÖ Payment Schedules (—ç—Ç–∞–ø—ã –æ–ø–ª–∞—Ç—ã)
- ‚úÖ API endpoints: create_intent, webhooks

### 9. Ledger Service ‚úÖ
- ‚úÖ Append-only ledger –¥–ª—è –≤—Å–µ—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–æ–¥–∫–∏ (payment_in, acq_fee, bank_rebate)
- ‚úÖ Split –º–µ–∂–¥—É —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏ –ø–æ –ø—Ä–∞–≤–∏–ª–∞–º
- ‚úÖ –ü–æ–¥—Å—á—ë—Ç –±–∞–ª–∞–Ω—Å–æ–≤ –ø–æ —Å—á–µ—Ç–∞–º
- ‚úÖ –≠–∫–æ–Ω–æ–º–∏–∫–∞: 2% —ç–∫–≤–∞–π—Ä–∏–Ω–≥, 1.3% –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ

### 10. Antifraud Service ‚úÖ
- ‚úÖ –õ–∏–º–∏—Ç—ã –¥–ª—è –Ω–æ–≤—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤
- ‚úÖ Velocity checks (—Å–¥–µ–ª–æ–∫ –≤ –¥–µ–Ω—å)
- ‚úÖ Blacklist (–ø–∞—Å–ø–æ—Ä—Ç, –ò–ù–ù, —Ç–µ–ª–µ—Ñ–æ–Ω)
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –ª–∏–º–∏—Ç–æ–≤

## üìã TODO (Frontend –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏)

### 11. Frontend: Agent Console
- [ ] React + TypeScript + Vite
- [ ] –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ OTP
- [ ] –°–æ–∑–¥–∞–Ω–∏–µ —Å–¥–µ–ª–æ–∫ (—Ñ–æ—Ä–º–∞)
- [ ] –°–ø–∏—Å–æ–∫ —Å–¥–µ–ª–æ–∫
- [ ] –î–µ—Ç–∞–ª–∏ —Å–¥–µ–ª–∫–∏

### 12. Frontend: Client Portal
- [ ] Magic link –≤—Ö–æ–¥
- [ ] –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–æ–≥–æ–≤–æ—Ä–∞
- [ ] –ü–æ–¥–ø–∏—Å–∞–Ω–∏–µ —á–µ—Ä–µ–∑ SMS
- [ ] –û–ø–ª–∞—Ç–∞ –ø–æ –°–ë–ü
- [ ] –ß–µ–∫–∏ –∏ —Å—Ç–∞—Ç—É—Å—ã

### 13. Frontend: Agency Admin
- [ ] –†–µ–µ—Å—Ç—Ä —Å–¥–µ–ª–æ–∫ –∞–≥–µ–Ω—Ç—Å—Ç–≤–∞
- [ ] –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–æ–º–∏—Å—Å–∏–π
- [ ] –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞–º–∏
- [ ] –û—Ç—á—ë—Ç—ã –∏ –≤—ã–≥—Ä—É–∑–∫–∏

### 14. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- [ ] –†–µ–∞–ª—å–Ω—ã–π SMS –ø—Ä–æ–≤–∞–π–¥–µ—Ä (SMS.ru / Devino)
- [ ] KYC API (–§–ù–°, –ú–í–î, –†–æ—Å—Ñ–∏–Ω–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥)
- [ ] –†–µ–∞–ª—å–Ω—ã–π payment provider (–°–ë–ü)
- [ ] –§–∏—Å–∫–∞–ª–∏–∑–∞—Ü–∏—è (54-–§–ó)

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

- **Models**: 18 —Ç–∞–±–ª–∏—Ü (100% –≥–æ—Ç–æ–≤–æ)
- **Services**: 9 –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤—ã—Ö
  - Auth & User
  - Organization
  - Deal
  - Document
  - Signature (–ü–≠–ü)
  - Payment (–°–ë–ü)
  - Ledger
  - Antifraud
  - Storage (S3/MinIO)
- **API Endpoints**: 25+ —Ä–∞–±–æ—Ç–∞—é—â–∏—Ö
- **Lines of Code**: ~5000+
- **Test Coverage**: TODO

## üéØ –ë–ª–∏–∂–∞–π—à–∏–µ —à–∞–≥–∏

1. ‚úÖ **Backend MVP** - –ü–û–õ–ù–û–°–¢–¨–Æ –ì–û–¢–û–í!
2. **Frontend: Agent Console** - React –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –∞–≥–µ–Ω—Ç–æ–≤
3. **Frontend: Client Portal** - –ø–æ–¥–ø–∏—Å–∞–Ω–∏–µ –∏ –æ–ø–ª–∞—Ç–∞ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤
4. **Frontend: Agency Admin** - –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è –∞–≥–µ–Ω—Ç—Å—Ç–≤
5. **–†–µ–∞–ª—å–Ω—ã–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏** - SMS.ru, KYC APIs, —Ä–µ–∞–ª—å–Ω—ã–π –°–ë–ü

## üöÄ –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å (—Å–µ–π—á–∞—Å)

```bash
# 1. –ó–∞–ø—É—Å—Ç–∏—Ç—å –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É
docker-compose up -d

# 2. Backend
cd backend
python -m venv venv
source venv/bin/activate
pip install -r requirements.txt

# 3. –°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—É—é –º–∏–≥—Ä–∞—Ü–∏—é
alembic revision --autogenerate -m "Initial schema"
alembic upgrade head

# 4. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä
uvicorn app.main:app --reload

# 5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
curl http://localhost:8000/health
# Swagger UI: http://localhost:8000/docs
```

## üìù –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

### –ú–æ–¥—É–ª—å–Ω—ã–π –º–æ–Ω–æ–ª–∏—Ç
- –ù–∞—á–∏–Ω–∞–µ–º —Å –º–æ–Ω–æ–ª–∏—Ç–∞ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ MVP
- –°–µ—Ä–≤–∏—Å—ã –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã (–º–æ–∂–Ω–æ –≤—ã–¥–µ–ª–∏—Ç—å –≤ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã –ø–æ–∑–∂–µ)
- Async/await –¥–ª—è –≤—ã—Å–æ–∫–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### Database First
- SQLAlchemy models –∫–∞–∫ –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã
- Alembic –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–π
- Async session –¥–ª—è FastAPI

### –ü–≠–ü —á–µ—Ä–µ–∑ OTP
- –ü—Ä–æ—Å—Ç–∞—è –ø–æ–¥–ø–∏—Å—å –ø–æ 63-–§–ó
- Evidence logging –¥–ª—è —é—Ä–∏–¥–∏—á–µ—Å–∫–æ–π —Å–∏–ª—ã
- SHA-256 —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

### MoR –º–æ–¥–µ–ª—å
- –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ = –ø–æ–ª—É—á–∞—Ç–µ–ª—å –ø–ª–∞—Ç–µ–∂–µ–π
- Ledger –¥–ª—è –≤—Å–µ—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π split –∏ –≤—ã–ø–ª–∞—Ç—ã

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ JWT —Å expiration
- ‚úÖ OTP —Å –ª–∏–º–∏—Ç–∞–º–∏ –ø–æ–ø—ã—Ç–æ–∫ –∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π
- ‚úÖ Password hashing (bcrypt)
- ‚úÖ CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
- ‚è≥ Rate limiting (TODO)
- ‚è≥ Input validation —á–µ—Ä–µ–∑ Pydantic
- ‚è≥ SQL injection –∑–∞—â–∏—Ç–∞ (SQLAlchemy)

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [README.md](./README.md) - –æ–±—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ
- [SETUP.md](./SETUP.md) - –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∑–∞–ø—É—Å–∫—É
- [–¢–ó](./tz-agent-deals-platform%20(1).docx) - –ø–æ–ª–Ω–æ–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ
- Swagger UI: http://localhost:8000/docs

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: 23 –¥–µ–∫–∞–±—Ä—è 2025
**–í–µ—Ä—Å–∏—è**: 0.1.0 (MVP –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)

