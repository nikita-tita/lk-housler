# ğŸ— ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ° lk.housler.ru

## ğŸ“ High-Level Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         FRONTEND                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚    Agent     â”‚  â”‚   Client     â”‚  â”‚   Agency     â”‚     â”‚
â”‚  â”‚   Console    â”‚  â”‚   Portal     â”‚  â”‚    Admin     â”‚     â”‚
â”‚  â”‚  (Next.js)   â”‚  â”‚  (Next.js)   â”‚  â”‚  (Next.js)   â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚         â”‚                 â”‚                  â”‚              â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                           â”‚                                 â”‚
â”‚                           â–¼                                 â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚                    â”‚    Nginx    â”‚                          â”‚
â”‚                    â”‚  (Reverse   â”‚                          â”‚
â”‚                    â”‚   Proxy)    â”‚                          â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          â–¼                                   â”‚
â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚                   â”‚   FastAPI    â”‚                          â”‚
â”‚                   â”‚   Backend    â”‚                          â”‚
â”‚                   â”‚  (Python)    â”‚                          â”‚
â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                          â”‚                                   â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚         â”‚                â”‚                â”‚                 â”‚
â”‚         â–¼                â–¼                â–¼                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚PostgreSQL â”‚   â”‚  Redis   â”‚    â”‚  MinIO   â”‚             â”‚
â”‚  â”‚   (DB)    â”‚   â”‚ (Cache)  â”‚    â”‚   (S3)   â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ External Services
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                 â”‚                 â”‚
         â–¼                 â–¼                 â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ SMS.RU  â”‚       â”‚   Ğ¡Ğ‘ĞŸ   â”‚      â”‚   ĞšYC   â”‚
   â”‚         â”‚       â”‚ Banking â”‚      â”‚Provider â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ Backend Architecture (Layered)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      API Layer                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ FastAPI Endpoints                                     â”‚ â”‚
â”‚  â”‚ - /api/v1/auth/*     (7 endpoints)                   â”‚ â”‚
â”‚  â”‚ - /api/v1/users/*    (4 endpoints)                   â”‚ â”‚
â”‚  â”‚ - /api/v1/organizations/*  (8 endpoints)             â”‚ â”‚
â”‚  â”‚ - /api/v1/deals/*    (6 endpoints)                   â”‚ â”‚
â”‚  â”‚ - /api/v1/documents/* (4 endpoints)                  â”‚ â”‚
â”‚  â”‚ - /api/v1/payments/* (3 endpoints)                   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Service Layer                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Business Logic Services (9)                          â”‚ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚ 1. Auth Service (3 Ñ‚Ğ¸Ğ¿Ğ° Ğ²Ñ…Ğ¾Ğ´Ğ° + Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ)        â”‚ â”‚
â”‚  â”‚ 2. User Service (CRUD + Ğ¿Ğ¾Ğ¸ÑĞº)                       â”‚ â”‚
â”‚  â”‚ 3. Organization Service (Ğ°Ğ³ĞµĞ½Ñ‚ÑÑ‚Ğ²Ğ°)                  â”‚ â”‚
â”‚  â”‚ 4. Deal Service (ÑĞ´ĞµĞ»ĞºĞ¸)                             â”‚ â”‚
â”‚  â”‚ 5. Document Service (Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ PDF)                  â”‚ â”‚
â”‚  â”‚ 6. Signature Service (ĞŸĞ­ĞŸ)                           â”‚ â”‚
â”‚  â”‚ 7. Payment Service (Ğ¡Ğ‘ĞŸ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ)                  â”‚ â”‚
â”‚  â”‚ 8. Ledger Service (Ğ±ÑƒÑ…Ğ³Ğ°Ğ»Ñ‚ĞµÑ€Ğ¸Ñ)                      â”‚ â”‚
â”‚  â”‚ 9. Antifraud Service (Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸)                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Data Layer                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ SQLAlchemy ORM Models (24 Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹)                   â”‚ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚ Users & Auth:                                        â”‚ â”‚
â”‚  â”‚ - users, user_profiles, user_consents, otp_sessions  â”‚ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚ Organizations:                                        â”‚ â”‚
â”‚  â”‚ - organizations, organization_members, payout_accountsâ”‚ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚ Deals:                                               â”‚ â”‚
â”‚  â”‚ - deals, deal_parties, deal_terms                    â”‚ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚ Documents:                                           â”‚ â”‚
â”‚  â”‚ - contract_templates, documents, signatures, audit_logsâ”‚ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚ Payments:                                            â”‚ â”‚
â”‚  â”‚ - payment_schedules, payment_intents, payments       â”‚ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚ Ledger:                                              â”‚ â”‚
â”‚  â”‚ - ledger_entries, splits, payouts                    â”‚ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚ Receipts:                                            â”‚ â”‚
â”‚  â”‚ - receipts, npd_tasks                                â”‚ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚ Antifraud:                                           â”‚ â”‚
â”‚  â”‚ - antifraud_checks, user_limits, blacklist           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Infrastructure                            â”‚
â”‚                                                             â”‚
â”‚  PostgreSQL 15     Redis 7      MinIO (S3)                â”‚
â”‚  (Primary DB)      (Cache)      (Documents)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” Security Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Security Layers                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  1. Transport Layer                                     â”‚
â”‚     â”œâ”€ HTTPS/TLS (Certbot SSL)                         â”‚
â”‚     â””â”€ Security Headers (Nginx)                        â”‚
â”‚                                                          â”‚
â”‚  2. Authentication Layer                                â”‚
â”‚     â”œâ”€ JWT Tokens (7 days)                             â”‚
â”‚     â”œâ”€ SMS OTP (Ğ´Ğ»Ñ Ğ°Ğ³ĞµĞ½Ñ‚Ğ¾Ğ²)                           â”‚
â”‚     â”œâ”€ Email OTP (Ğ´Ğ»Ñ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ¾Ğ²)                        â”‚
â”‚     â””â”€ Password Hash (Ğ´Ğ»Ñ Ğ°Ğ³ĞµĞ½Ñ‚ÑÑ‚Ğ², bcrypt)            â”‚
â”‚                                                          â”‚
â”‚  3. Authorization Layer                                 â”‚
â”‚     â”œâ”€ Role-based (5 Ñ€Ğ¾Ğ»ĞµĞ¹)                            â”‚
â”‚     â”‚  â”œâ”€ client                                        â”‚
â”‚     â”‚  â”œâ”€ agent                                         â”‚
â”‚     â”‚  â”œâ”€ agency_admin                                  â”‚
â”‚     â”‚  â”œâ”€ operator                                      â”‚
â”‚     â”‚  â””â”€ admin                                         â”‚
â”‚     â””â”€ Dependency injection (@Depends)                  â”‚
â”‚                                                          â”‚
â”‚  4. Data Protection Layer (152-Ğ¤Ğ—)                      â”‚
â”‚     â”œâ”€ PII Encryption (AES-256)                        â”‚
â”‚     â”‚  â”œâ”€ Email                                         â”‚
â”‚     â”‚  â”œâ”€ Phone                                         â”‚
â”‚     â”‚  â”œâ”€ Full Name                                     â”‚
â”‚     â”‚  â””â”€ INN                                           â”‚
â”‚     â””â”€ Search Hashes (SHA-256)                         â”‚
â”‚                                                          â”‚
â”‚  5. Compliance Layer                                    â”‚
â”‚     â”œâ”€ User Consents (5 Ñ‚Ğ¸Ğ¿Ğ¾Ğ²)                        â”‚
â”‚     â”œâ”€ KYC/AML Checks (115-Ğ¤Ğ—)                         â”‚
â”‚     â”œâ”€ Antifraud System                                â”‚
â”‚     â””â”€ Audit Logs                                      â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Authentication Flows

### Flow 1: SMS Auth (Agent)

```
â”Œâ”€â”€â”€â”€â”€â”€â”                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”
â”‚Clientâ”‚                â”‚ Backend â”‚              â”‚SMS.RUâ”‚
â””â”€â”€â”€â”¬â”€â”€â”˜                â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”¬â”€â”€â”˜
    â”‚                        â”‚                       â”‚
    â”‚ POST /agent/sms/send   â”‚                       â”‚
    â”‚ {phone}                â”‚                       â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                       â”‚
    â”‚                        â”‚                       â”‚
    â”‚                        â”‚ Generate OTP (6 digits)â”‚
    â”‚                        â”‚                       â”‚
    â”‚                        â”‚ Send SMS              â”‚
    â”‚                        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
    â”‚                        â”‚                       â”‚
    â”‚                        â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚                        â”‚  SMS sent OK          â”‚
    â”‚                        â”‚                       â”‚
    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                       â”‚
    â”‚ {message: "SMS sent"}  â”‚                       â”‚
    â”‚                        â”‚                       â”‚
    â”‚ POST /agent/sms/verify â”‚                       â”‚
    â”‚ {phone, code}          â”‚                       â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                       â”‚
    â”‚                        â”‚                       â”‚
    â”‚                        â”‚ Verify OTP            â”‚
    â”‚                        â”‚ Get/Create User       â”‚
    â”‚                        â”‚ Generate JWT          â”‚
    â”‚                        â”‚                       â”‚
    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                       â”‚
    â”‚ {access_token,         â”‚                       â”‚
    â”‚  refresh_token}        â”‚                       â”‚
    â”‚                        â”‚                       â”‚
```

### Flow 2: Email Auth (Client)

```
â”Œâ”€â”€â”€â”€â”€â”€â”                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”
â”‚Clientâ”‚                â”‚ Backend â”‚              â”‚Email â”‚
â””â”€â”€â”€â”¬â”€â”€â”˜                â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”¬â”€â”€â”˜
    â”‚                        â”‚                       â”‚
    â”‚ POST /client/email/sendâ”‚                       â”‚
    â”‚ {email}                â”‚                       â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                       â”‚
    â”‚                        â”‚                       â”‚
    â”‚                        â”‚ Generate OTP (6 digits)â”‚
    â”‚                        â”‚                       â”‚
    â”‚                        â”‚ Send Email            â”‚
    â”‚                        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
    â”‚                        â”‚                       â”‚
    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                       â”‚
    â”‚ {message: "Email sent"}â”‚                       â”‚
    â”‚                        â”‚                       â”‚
    â”‚ POST /client/email/verifyâ”‚                     â”‚
    â”‚ {email, code}          â”‚                       â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                       â”‚
    â”‚                        â”‚                       â”‚
    â”‚                        â”‚ Verify OTP            â”‚
    â”‚                        â”‚ Get/Create User       â”‚
    â”‚                        â”‚ Generate JWT          â”‚
    â”‚                        â”‚                       â”‚
    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                       â”‚
    â”‚ {access_token,         â”‚                       â”‚
    â”‚  refresh_token}        â”‚                       â”‚
    â”‚                        â”‚                       â”‚
```

### Flow 3: Agency Login (Email + Password)

```
â”Œâ”€â”€â”€â”€â”€â”€â”                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Clientâ”‚                â”‚ Backend â”‚
â””â”€â”€â”€â”¬â”€â”€â”˜                â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
    â”‚                        â”‚
    â”‚ POST /agency/login     â”‚
    â”‚ {email, password}      â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
    â”‚                        â”‚
    â”‚                        â”‚ Find User by Email Hash
    â”‚                        â”‚ Verify Password (bcrypt)
    â”‚                        â”‚ Check Role = agency_admin
    â”‚                        â”‚ Generate JWT
    â”‚                        â”‚
    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ {access_token,         â”‚
    â”‚  refresh_token}        â”‚
    â”‚                        â”‚
```

---

## ğŸ’¸ Payment Flow (Ğ¡Ğ‘ĞŸ)

```
â”Œâ”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Agent â”‚   â”‚ Backend â”‚   â”‚Clientâ”‚   â”‚   Ğ¡Ğ‘ĞŸ    â”‚   â”‚ Ledger  â”‚
â””â”€â”€â”€â”¬â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”¬â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
    â”‚           â”‚             â”‚           â”‚              â”‚
    â”‚ Create    â”‚             â”‚           â”‚              â”‚
    â”‚ Payment   â”‚             â”‚           â”‚              â”‚
    â”‚ Intent    â”‚             â”‚           â”‚              â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚             â”‚           â”‚              â”‚
    â”‚           â”‚             â”‚           â”‚              â”‚
    â”‚           â”‚ Generate    â”‚           â”‚              â”‚
    â”‚           â”‚ Payment URL â”‚           â”‚              â”‚
    â”‚           â”‚             â”‚           â”‚              â”‚
    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤             â”‚           â”‚              â”‚
    â”‚ {url, id} â”‚             â”‚           â”‚              â”‚
    â”‚           â”‚             â”‚           â”‚              â”‚
    â”‚ Send URL  â”‚             â”‚           â”‚              â”‚
    â”‚ to Client â”‚             â”‚           â”‚              â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚           â”‚              â”‚
    â”‚           â”‚             â”‚           â”‚              â”‚
    â”‚           â”‚             â”‚ Pay via   â”‚              â”‚
    â”‚           â”‚             â”‚ Ğ¡Ğ‘ĞŸ App   â”‚              â”‚
    â”‚           â”‚             â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚              â”‚
    â”‚           â”‚             â”‚           â”‚              â”‚
    â”‚           â”‚             â”‚           â”‚ Payment      â”‚
    â”‚           â”‚             â”‚           â”‚ Successful   â”‚
    â”‚           â”‚             â”‚           â”‚              â”‚
    â”‚           â”‚  Webhook    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚
    â”‚           â”‚  Notify     â”‚           â”‚              â”‚
    â”‚           â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤           â”‚              â”‚
    â”‚           â”‚             â”‚           â”‚              â”‚
    â”‚           â”‚ Process     â”‚           â”‚              â”‚
    â”‚           â”‚ Payment     â”‚           â”‚              â”‚
    â”‚           â”‚             â”‚           â”‚              â”‚
    â”‚           â”‚ Calculate   â”‚           â”‚              â”‚
    â”‚           â”‚ Splits      â”‚           â”‚              â”‚
    â”‚           â”‚             â”‚           â”‚              â”‚
    â”‚           â”‚ Record      â”‚           â”‚              â”‚
    â”‚           â”‚ Ledger      â”‚           â”‚              â”‚
    â”‚           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
    â”‚           â”‚             â”‚           â”‚              â”‚
    â”‚           â”‚             â”‚           â”‚              â”‚ Ledger
    â”‚           â”‚             â”‚           â”‚              â”‚ Entries:
    â”‚           â”‚             â”‚           â”‚              â”‚ - Platform
    â”‚           â”‚             â”‚           â”‚              â”‚ - Agent
    â”‚           â”‚             â”‚           â”‚              â”‚ - Agency
    â”‚           â”‚             â”‚           â”‚              â”‚
```

---

## ğŸ“‚ Project Structure (Detailed)

```
lk/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ api/                    # API Layer
â”‚   â”‚   â”‚   â”œâ”€â”€ deps.py            # Dependencies (auth, db)
â”‚   â”‚   â”‚   â””â”€â”€ v1/
â”‚   â”‚   â”‚       â”œâ”€â”€ endpoints/
â”‚   â”‚   â”‚       â”‚   â”œâ”€â”€ auth.py           # 7 auth endpoints
â”‚   â”‚   â”‚       â”‚   â”œâ”€â”€ users.py          # 4 user endpoints
â”‚   â”‚   â”‚       â”‚   â”œâ”€â”€ organizations.py  # 8 org endpoints
â”‚   â”‚   â”‚       â”‚   â”œâ”€â”€ deals.py          # 6 deal endpoints
â”‚   â”‚   â”‚       â”‚   â”œâ”€â”€ documents.py      # 4 doc endpoints
â”‚   â”‚   â”‚       â”‚   â””â”€â”€ payments.py       # 3 payment endpoints
â”‚   â”‚   â”‚       â””â”€â”€ router.py      # Main router
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ core/                   # Core Infrastructure
â”‚   â”‚   â”‚   â”œâ”€â”€ config.py          # Settings (env vars)
â”‚   â”‚   â”‚   â”œâ”€â”€ security.py        # JWT, password, OTP
â”‚   â”‚   â”‚   â””â”€â”€ encryption.py      # PII encryption (AES-256)
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ db/                     # Database
â”‚   â”‚   â”‚   â”œâ”€â”€ base.py            # Base model
â”‚   â”‚   â”‚   â””â”€â”€ session.py         # Async session
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ models/                 # SQLAlchemy Models
â”‚   â”‚   â”‚   â”œâ”€â”€ user.py            # User, UserProfile, Consents
â”‚   â”‚   â”‚   â”œâ”€â”€ organization.py    # Organization, Members
â”‚   â”‚   â”‚   â”œâ”€â”€ deal.py            # Deal, DealParty, DealTerms
â”‚   â”‚   â”‚   â”œâ”€â”€ document.py        # Documents, Signatures
â”‚   â”‚   â”‚   â”œâ”€â”€ payment.py         # Payments, Intents
â”‚   â”‚   â”‚   â”œâ”€â”€ ledger.py          # Ledger, Splits, Payouts
â”‚   â”‚   â”‚   â”œâ”€â”€ receipt.py         # Receipts, NPD tasks
â”‚   â”‚   â”‚   â””â”€â”€ antifraud.py       # Antifraud checks
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ schemas/                # Pydantic Schemas
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.py            # Auth requests/responses
â”‚   â”‚   â”‚   â”œâ”€â”€ user.py            # User schemas
â”‚   â”‚   â”‚   â”œâ”€â”€ organization.py    # Org schemas
â”‚   â”‚   â”‚   â””â”€â”€ deal.py            # Deal schemas
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ services/               # Business Logic
â”‚   â”‚   â”‚   â”œâ”€â”€ auth/              # Auth service (3 types)
â”‚   â”‚   â”‚   â”œâ”€â”€ user/              # User service
â”‚   â”‚   â”‚   â”œâ”€â”€ organization/      # Org service
â”‚   â”‚   â”‚   â”œâ”€â”€ deal/              # Deal service
â”‚   â”‚   â”‚   â”œâ”€â”€ document/          # Document service
â”‚   â”‚   â”‚   â”œâ”€â”€ signature/         # Signature service
â”‚   â”‚   â”‚   â”œâ”€â”€ payment/           # Payment service
â”‚   â”‚   â”‚   â”œâ”€â”€ ledger/            # Ledger service
â”‚   â”‚   â”‚   â”œâ”€â”€ antifraud/         # Antifraud service
â”‚   â”‚   â”‚   â”œâ”€â”€ storage/           # S3 storage
â”‚   â”‚   â”‚   â”œâ”€â”€ sms/               # SMS provider
â”‚   â”‚   â”‚   â””â”€â”€ email/             # Email provider
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ main.py                 # FastAPI app
â”‚   â”‚
â”‚   â”œâ”€â”€ alembic/                    # Database migrations
â”‚   â”‚   â”œâ”€â”€ env.py
â”‚   â”‚   â””â”€â”€ versions/               # Migration files
â”‚   â”‚
â”‚   â”œâ”€â”€ requirements.txt            # Python dependencies
â”‚   â”œâ”€â”€ Dockerfile                  # Docker image
â”‚   â””â”€â”€ alembic.ini                 # Alembic config
â”‚
â”œâ”€â”€ nginx/
â”‚   â”œâ”€â”€ lk.housler.ru.conf         # External server config
â”‚   â””â”€â”€ nginx.conf                  # Docker internal proxy
â”‚
â”œâ”€â”€ docker-compose.yml              # Dev environment
â”œâ”€â”€ docker-compose.prod.yml         # Production environment
â”‚
â”œâ”€â”€ START_PROJECT.sh                # Auto-start script
â”‚
â””â”€â”€ docs/                           # Documentation (13 files)
    â”œâ”€â”€ README.md
    â”œâ”€â”€ QUICK_START_CHECKLIST.md
    â”œâ”€â”€ PROJECT_STATUS.md
    â”œâ”€â”€ NEXT_STEPS.md
    â”œâ”€â”€ FINAL_REVIEW.md
    â”œâ”€â”€ ARCHITECTURE.md (this file)
    â”œâ”€â”€ API_AUTH_GUIDE.md
    â”œâ”€â”€ API_PAYMENTS_GUIDE.md
    â”œâ”€â”€ BACKEND_READY.md
    â”œâ”€â”€ HOUSLER_ECOSYSTEM.md
    â”œâ”€â”€ HOUSLER_INTEGRATION.md
    â”œâ”€â”€ QUICKSTART_HOUSLER.md
    â””â”€â”€ CLAUDE.md
```

---

## ğŸ”Œ External Services Integration

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Backend Services                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  SMS.RU (Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ¾ âœ…)                                     â”‚
â”‚  â”œâ”€ API ID: ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ¸Ñ€ÑƒĞµĞ¼Ñ‹Ğ¹                             â”‚
â”‚  â”œâ”€ Test Mode: Ñ‚ĞµĞ»ĞµÑ„Ğ¾Ğ½Ñ‹ 79999XXXXXX, ĞºĞ¾Ğ´Ñ‹ 111111-666666â”‚
â”‚  â””â”€ Production: Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ°Ñ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° SMS                   â”‚
â”‚                                                          â”‚
â”‚  Email Provider (Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ¾ âœ…)                             â”‚
â”‚  â”œâ”€ Mock Provider (Ğ´Ğ»Ñ dev)                            â”‚
â”‚  â””â”€ SMTP Provider (Ğ´Ğ»Ñ production)                      â”‚
â”‚                                                          â”‚
â”‚  MinIO S3 (Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ¾ âœ…)                                   â”‚
â”‚  â”œâ”€ Ğ¥Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ¾Ğ² (PDF)                          â”‚
â”‚  â”œâ”€ ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑĞ°Ğ½Ğ½Ñ‹Ğµ Ğ´Ğ¾Ğ³Ğ¾Ğ²Ğ¾Ñ€Ñ‹                                â”‚
â”‚  â””â”€ Audit trail files                                   â”‚
â”‚                                                          â”‚
â”‚  Ğ¡Ğ‘ĞŸ Integration (TODO â³)                              â”‚
â”‚  â”œâ”€ Payment Intent creation                             â”‚
â”‚  â”œâ”€ Webhook handling                                    â”‚
â”‚  â””â”€ Automatic split payments                            â”‚
â”‚                                                          â”‚
â”‚  KYC Provider (TODO â³)                                 â”‚
â”‚  â”œâ”€ Sumsub / Ğ´Ñ€ÑƒĞ³Ğ¾Ğ¹ Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€                          â”‚
â”‚  â”œâ”€ ĞŸĞ°ÑĞ¿Ğ¾Ñ€Ñ‚ + Ğ¡ĞµĞ»Ñ„Ğ¸                                     â”‚
â”‚  â””â”€ Webhook Ğ´Ğ»Ñ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ¾Ğ²                             â”‚
â”‚                                                          â”‚
â”‚  Ğ¤ĞĞ¡ API (TODO â³)                                      â”‚
â”‚  â”œâ”€ Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ñ‡ĞµĞºĞ¾Ğ² ĞĞŸĞ”                                â”‚
â”‚  â””â”€ ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ°Ğ¼                                   â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Database Schema (ERD Overview)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    users     â”‚â”€â”€â”€â”€â”€â”€â”€â”‚  user_profiles  â”‚       â”‚ user_consents â”‚
â”‚              â”‚ 1:1   â”‚                 â”‚       â”‚               â”‚
â”‚ - id         â”‚       â”‚ - user_id (FK)  â”‚       â”‚ - user_id (FK)â”‚
â”‚ - role       â”‚       â”‚ - full_name_enc â”‚       â”‚ - type        â”‚
â”‚ - phone_enc  â”‚       â”‚ - inn_enc       â”‚       â”‚ - granted     â”‚
â”‚ - phone_hash â”‚       â”‚ - kyc_level     â”‚       â”‚ - ip_address  â”‚
â”‚ - email_enc  â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ - email_hash â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 1:N
       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ organization_     â”‚
â”‚ members           â”‚
â”‚                   â”‚
â”‚ - org_id (FK)     â”‚
â”‚ - user_id (FK)    â”‚
â”‚ - role            â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ N:1
       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ organizations     â”‚â”€â”€â”€â”€â”€â”€â”‚ payout_accounts â”‚
â”‚                   â”‚ 1:N  â”‚                 â”‚
â”‚ - legal_name      â”‚      â”‚ - org_id (FK)   â”‚
â”‚ - inn             â”‚      â”‚ - method        â”‚
â”‚ - kyc_status      â”‚      â”‚ - details       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    deals      â”‚â”€â”€â”€â”€â”€â”€â”‚ deal_partiesâ”‚      â”‚  deal_terms    â”‚
â”‚               â”‚ 1:N  â”‚             â”‚      â”‚                â”‚
â”‚ - type        â”‚      â”‚ - deal_id   â”‚      â”‚ - deal_id (FK) â”‚
â”‚ - status      â”‚      â”‚ - user_id   â”‚      â”‚ - commission   â”‚
â”‚ - address     â”‚      â”‚ - type      â”‚      â”‚ - split_percentâ”‚
â”‚ - price       â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚ - schedule     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ 1:N
        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   documents         â”‚â”€â”€â”€â”€â”€â”‚  signatures  â”‚
â”‚                     â”‚ 1:N â”‚              â”‚
â”‚ - deal_id (FK)      â”‚     â”‚ - doc_id (FK)â”‚
â”‚ - type              â”‚     â”‚ - party_id   â”‚
â”‚ - s3_url            â”‚     â”‚ - signed_at  â”‚
â”‚ - hash (SHA-256)    â”‚     â”‚ - ip_address â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ payment_intents    â”‚â”€â”€â”€â”€â”€â”‚    payments     â”‚
â”‚                    â”‚ 1:1 â”‚                 â”‚
â”‚ - deal_id (FK)     â”‚     â”‚ - intent_id (FK)â”‚
â”‚ - amount           â”‚     â”‚ - status        â”‚
â”‚ - sbp_url          â”‚     â”‚ - paid_at       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                          â”‚
         â”‚                          â”‚ 1:N
         â”‚                          â”‚
         â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                  â”‚ ledger_entries  â”‚
         â”‚                  â”‚                 â”‚
         â”‚                  â”‚ - account       â”‚
         â”‚                  â”‚ - debit         â”‚
         â”‚                  â”‚ - credit        â”‚
         â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ Next: Frontend Architecture

**Ğ¡Ğ¼. [NEXT_STEPS.md](./NEXT_STEPS.md)** Ğ´Ğ»Ñ Ğ¿Ğ»Ğ°Ğ½Ğ° Frontend Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸

---

**Ğ”Ğ°Ñ‚Ğ°**: 23 Ğ´ĞµĞºĞ°Ğ±Ñ€Ñ 2025  
**Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ**: Backend 100% Ğ³Ğ¾Ñ‚Ğ¾Ğ² âœ…

