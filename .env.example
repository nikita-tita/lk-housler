# ===========================================
# LK Housler - Environment Variables
# ===========================================
# Скопируй в .env и заполни реальными значениями

# ===========================================
# Database (PostgreSQL)
# ===========================================
DB_HOST=postgres
DB_PORT=5432
DB_NAME=lk_housler
DB_USER=lk_user
DB_PASSWORD=CHANGE_ME_SECURE_PASSWORD

# Полный URL для SQLAlchemy
DATABASE_URL=postgresql://${DB_USER}:${DB_PASSWORD}@${DB_HOST}:${DB_PORT}/${DB_NAME}

# ===========================================
# Redis
# ===========================================
# Generate password: openssl rand -base64 24 | tr -d '/+='
REDIS_PASSWORD=CHANGE_THIS_SECURE_PASSWORD
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_URL=redis://:${REDIS_PASSWORD}@${REDIS_HOST}:${REDIS_PORT}/0

# ===========================================
# MinIO (S3-compatible storage)
# ===========================================
MINIO_ENDPOINT=minio:9000
MINIO_ROOT_USER=minioadmin
MINIO_ROOT_PASSWORD=minioadmin
MINIO_BUCKET=lk-housler

# ===========================================
# Application
# ===========================================
APP_ENV=development
DEBUG=true
LOG_LEVEL=INFO

# API
API_HOST=0.0.0.0
API_PORT=8000

# Frontend URL (для CORS)
FRONTEND_URL=http://localhost:3000
NEXT_PUBLIC_API_URL=http://localhost:8000

# ===========================================
# Authentication (JWT)
# ===========================================
# SECURITY CRITICAL: Each service MUST have its own unique JWT_SECRET!
# - lk.housler.ru: unique JWT_SECRET (this file)
# - agent.housler.ru: different JWT_SECRET
# Shared secrets allow cross-service token forgery if one is compromised.
#
# Generate secure secret:
#   openssl rand -base64 32
JWT_SECRET=CHANGE_ME_GENERATE_SECURE_SECRET
JWT_ALGORITHM=HS256
JWT_EXPIRES_IN=7d
ACCESS_TOKEN_EXPIRE_MINUTES=10080

# ===========================================
# PII Encryption (152-ФЗ) - REQUIRED, NO DEFAULTS!
# ===========================================
# CRITICAL: Both values are REQUIRED. App will not start without them.
# CRITICAL: Once set and data encrypted, DO NOT CHANGE - data will be lost!
# CRITICAL: Must match between lk.housler.ru and agent.housler.ru

# Generate ENCRYPTION_KEY:
#   openssl rand -hex 32
ENCRYPTION_KEY=CHANGE_ME_GENERATE_32_BYTE_HEX_KEY

# Generate ENCRYPTION_SALT:
#   openssl rand -base64 32
# WARNING: In production, salt containing "housler_salt" is BLOCKED!
ENCRYPTION_SALT=CHANGE_ME_GENERATE_UNIQUE_SALT

# ===========================================
# SMS Provider (SMS.RU)
# ===========================================
# Провайдер: sms_ru | twilio | vonage
SMS_PROVIDER=sms_ru

# SMS.RU (основной)
SMS_RU_API_ID=YOUR_SMS_RU_API_ID_HERE

# Тестовый режим (true = SMS не отправляются)
SMS_TEST_MODE=true

# Twilio (опционально)
# TWILIO_ACCOUNT_SID=
# TWILIO_AUTH_TOKEN=
# TWILIO_PHONE_NUMBER=

# ===========================================
# Email (Yandex 360 SMTP или SendGrid)
# ===========================================
# Провайдеры:
# - mock: тестовый режим (вывод в консоль)
# - smtp: Yandex 360 SMTP (требует открытые порты 465/587)
# - sendgrid: SendGrid HTTP API (работает если SMTP заблокирован)
EMAIL_PROVIDER=mock

# --- Yandex 360 SMTP ---
# Если SMTP порты заблокированы хостингом, используйте SendGrid
# Настройки Yandex 360:
# 1. Создайте почтовый ящик в Yandex 360 для бизнеса
# 2. Создайте "пароль приложения" в настройках безопасности
#    (Настройки -> Безопасность -> Пароли приложений)
# 3. Используйте email как SMTP_USER, пароль приложения как SMTP_PASSWORD

SMTP_HOST=smtp.yandex.ru
SMTP_PORT=465
SMTP_USER=hello@housler.ru
SMTP_PASSWORD=CHANGE_ME_APP_PASSWORD
SMTP_FROM_EMAIL=hello@housler.ru
SMTP_FROM_NAME=Housler

# SSL/TLS:
# - Порт 465: SMTP_USE_SSL=true, SMTP_USE_TLS=false
# - Порт 587: SMTP_USE_SSL=false, SMTP_USE_TLS=true
SMTP_USE_SSL=true
SMTP_USE_TLS=false

# --- SendGrid (альтернатива) ---
# Используйте если SMTP порты заблокированы (reg.ru Cloud и др.)
# 1. Зарегистрируйтесь на sendgrid.com (бесплатно 100 писем/день)
# 2. Создайте API Key: Settings -> API Keys -> Create API Key
# 3. Верифицируйте домен: Settings -> Sender Authentication
SENDGRID_API_KEY=

# ===========================================
# Company Bank Details (для реквизитов в договорах)
# ===========================================
COMPANY_BANK_NAME=
COMPANY_BANK_BIK=
COMPANY_BANK_ACCOUNT=
COMPANY_BANK_CORR=

# ===========================================
# Yandex Cloud (AI features)
# ===========================================
YANDEX_FOLDER_ID=
YANDEX_OAUTH_TOKEN=
YANDEX_GPT_API_KEY=
YANDEX_GPT_FOLDER_ID=

# ===========================================
# Sentry (Error tracking)
# ===========================================
SENTRY_DSN=

# ===========================================
# CORS
# ===========================================
CORS_ORIGINS=http://localhost:3000,https://lk.housler.ru

# ===========================================
# Rate Limiting
# ===========================================
RATE_LIMIT_PER_MINUTE=60
SMS_RATE_LIMIT_PER_MINUTE=1

# ===========================================
# Test Accounts (для разработки)
# ===========================================
# Тестовые телефоны: 79999000000 - 79999999999
# Тестовые коды: 111111, 222222, 333333, 444444, 555555, 666666

# ===========================================
# T-Bank Integration (Bank Split)
# ===========================================
# Документация: https://www.tbank.ru/openapi/
# Номинальные счета (Nominal Accounts API)

# Режим работы: mock | sandbox | production
TBANK_MODE=mock

# Sandbox/Production credentials
TBANK_API_URL=https://securepay.tinkoff.ru/v2
TBANK_TERMINAL_KEY=
TBANK_SECRET_KEY=

# Nominal Accounts API (для сплита)
TBANK_NOMINAL_API_URL=https://business.tbank.ru/openapi/api/v1
TBANK_NOMINAL_TOKEN=

# Self-Employed API (для самозанятых)
TBANK_SE_API_URL=https://business.tbank.ru/openapi/api/v1/partner
TBANK_SE_PARTNER_ID=
TBANK_SE_TOKEN=

# Webhook verification
TBANK_WEBHOOK_SECRET=

# Hold period (seconds) - max 3600 (1 hour)
TBANK_HOLD_PERIOD_SECONDS=3600

# ===========================================
# Celery (Background Tasks)
# ===========================================
CELERY_BROKER_URL=redis://:${REDIS_PASSWORD}@${REDIS_HOST}:${REDIS_PORT}/1
CELERY_RESULT_BACKEND=redis://:${REDIS_PASSWORD}@${REDIS_HOST}:${REDIS_PORT}/2

# ===========================================
# Feature Flags (постепенное раскатывание)
# ===========================================
# INSTANT_SPLIT_ENABLED - глобальное включение bank-split
# INSTANT_SPLIT_ORG_IDS - whitelist организаций (UUID через запятую)
#
# Режимы работы:
# 1. ENABLED=false -> выключено для всех
# 2. ENABLED=true, ORG_IDS="" -> включено для всех
# 3. ENABLED=true, ORG_IDS="uuid1,uuid2" -> только для указанных организаций

INSTANT_SPLIT_ENABLED=false
INSTANT_SPLIT_ORG_IDS=

# ===========================================
# Production only
# ===========================================
# Раскомментировать для production

# APP_ENV=production
# DEBUG=false
# SMS_TEST_MODE=false
# FRONTEND_URL=https://lk.housler.ru
# NEXT_PUBLIC_API_URL=https://lk.housler.ru/api
# TBANK_MODE=production
