# Задачи для TPM — lk.housler.ru

**Дата:** 2026-01-16
**Обновлено:** 2026-01-16 (повторный тест)
**Источник:** Мануальное тестирование экосистемы

---

## Критические баги

### BUG-003: Форма регистрации риелтора не отправляется (RESOLVED)
**Приоритет:** HIGH
**Исполнитель:** FE-LK
**Статус:** ✅ ИСПРАВЛЕНО (2026-01-16 19:55)

**Описание:** После успешной авторизации (телефон + код) форма регистрации риелтора не отправляет данные на сервер. Кнопка "Зарегистрироваться" не работает.

**Причина:** React controlled components не синхронизировались с DOM при browser autofill.

**Исправление:**
- Добавлен `autoComplete="off"` на форму и чекбоксы
- Добавлен атрибут `name` на чекбоксы для корректной идентификации
- Коммит: `0be37f7` - "fix(frontend): prevent form state desync with browser autofill"

**Результат тестирования:**
- Форма успешно отправляет POST на `https://agent.housler.ru/api/auth/register-realtor`
- Получен ответ от API: "Пользователь с таким email уже существует" (ожидаемо для тестового email)

**DoD:**
- [x] Исправить синхронизацию React state с DOM для чекбоксов
- [x] Проверить логику валидации формы
- [x] Убедиться что форма отправляет POST запрос

---

### BUG-002: Тестовые коды не работают (ОБНОВЛЕНО)
**Приоритет:** LOW (понижен)
**Исполнитель:** BE-LK
**Статус:** Частично решено

**Описание:** Тестовые SMS коды `79999xxxxxx` не работают, НО тестовые Email работают (`*@test.housler.ru`).

**Workaround:** Использовать Email авторизацию для тестирования.

**DoD:**
- [ ] Включить тестовые SMS коды ИЛИ убрать надпись с UI
- [x] Email тестовые аккаунты работают

**Примечание:** Auth проксируется через agent.housler.ru

---

## Зависимости от agent.housler.ru

### SEC-001: Ротация секретов (входящая)
**Приоритет:** BLOCKER
**Ответственный:** INFRA-01 (agent)
**Роль lk:** Получатель обновлений

После ротации секретов в agent.housler.ru необходимо:
- [ ] Обновить JWT_SECRET в lk .env
- [ ] Обновить ENCRYPTION_KEY в lk .env
- [ ] Перезапустить lk-backend
- [ ] Проверить авторизацию

**Команды:**
```bash
ssh housler-server
cd /root/lk-housler

# Обновить .env с новыми секретами
nano .env

# Перезапустить
docker compose -f docker-compose.prod.yml up -d --force-recreate backend

# Проверить
docker logs lk-backend --tail 50
```

---

## Текущий статус проекта

| Компонент | Статус |
|-----------|--------|
| Auth (телефон+код) | ✅ Работает |
| Auth (email тестовые) | ✅ Работает |
| Регистрация риелтора | ✅ Работает (BUG-003 исправлен) |
| Сделки | ⏸️ Готово к тестированию |
| Backend | ✅ Работает |
| DB (shared) | ✅ Работает |

---

## Матрица назначений

| Задача | Исполнитель | Приоритет | Сложность |
|--------|-------------|-----------|-----------|
| BUG-003 | FE-LK | HIGH | M (2-4 часа) |
| BUG-002 | BE-LK + BE-AGENT | LOW | S (30 мин) |
| SEC-001 sync | INFRA (lk) | BLOCKER | S (15 мин) |

---

## Координация

**Срочно для FE-LK:**
- BUG-003 блокирует тестирование сделок

**Связаться с TPM agent.housler.ru по:**
1. BUG-002 — тестовые SMS коды (низкий приоритет, есть workaround)
2. SEC-001 — получить новые секреты после ротации

---

## Результаты теста 2026-01-16

**Что работает:**
- Авторизация по телефону (SMS код)
- Авторизация по email (тестовые `*@test.housler.ru`)
- Форма заполнения данных риелтора отображается
- Все поля валидируются корректно
- ✅ Отправка формы регистрации (BUG-003 исправлен)
- ✅ API отвечает корректно

**Готово к тестированию:**
- Тестирование сделок (разблокировано после BUG-003)
- Переход в личный кабинет (требует новый email для регистрации)

---

*Создано: 2026-01-16*
*Обновлено: 2026-01-16 19:55 — BUG-003 исправлен и задеплоен*
