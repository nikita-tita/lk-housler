# Задачи для TPM — lk.housler.ru

**Дата:** 2026-01-16
**Обновлено:** 2026-01-16 (повторный тест)
**Источник:** Мануальное тестирование экосистемы

---

## Критические баги

### BUG-003: Форма регистрации риелтора не отправляется (BLOCKER)
**Приоритет:** HIGH
**Исполнитель:** FE-LK

**Описание:** После успешной авторизации (телефон + код) форма регистрации риелтора не отправляет данные на сервер. Кнопка "Зарегистрироваться" не работает.

**Проблема:** React state не синхронизирован с DOM. Валидация блокирует submit даже когда все поля заполнены.

**Шаги воспроизведения:**
1. Открыть https://lk.housler.ru/realtor
2. Пройти авторизацию (телефон + код) — РАБОТАЕТ
3. Заполнить форму регистрации:
   - ФИО: Тестовый Риелтор Тестович
   - Email: test@test.housler.ru
   - Город: Санкт-Петербург
   - Самозанятый: да, ИНН: 123456789012
4. Отметить все обязательные согласия
5. Нажать "Зарегистрироваться"
6. → Ничего не происходит, сообщение "Необходимо принять обязательные соглашения"

**Техническая диагностика:**
- `form.dispatchEvent(submitEvent)` возвращает `false` — preventDefault вызывается
- Все чекбоксы `checked: true` в DOM
- Кнопка `disabled: false`
- Network запрос на `/register` не отправляется

**DoD:**
- [ ] Исправить синхронизацию React state с DOM для чекбоксов
- [ ] Проверить логику валидации формы
- [ ] Убедиться что форма отправляет POST запрос

---

### BUG-002: Тестовые коды не работают (ОБНОВЛЕНО)
**Приоритет:** LOW (понижен)
**Исполнитель:** BE-LK
**Статус:** Частично решено

**Описание:** Тестовые SMS коды `79999xxxxxx` не работают, НО тестовые Email работают (`*@test.housler.ru`).

**Workaround:** Использовать Email авторизацию для тестирования.

**DoD:**
- [ ] Включить тестовые SMS коды ИЛИ убрать надпись с UI
- [x] Email тестовые аккаунты работают

**Примечание:** Auth проксируется через agent.housler.ru

---

## Зависимости от agent.housler.ru

### SEC-001: Ротация секретов (входящая)
**Приоритет:** BLOCKER
**Ответственный:** INFRA-01 (agent)
**Роль lk:** Получатель обновлений

После ротации секретов в agent.housler.ru необходимо:
- [ ] Обновить JWT_SECRET в lk .env
- [ ] Обновить ENCRYPTION_KEY в lk .env
- [ ] Перезапустить lk-backend
- [ ] Проверить авторизацию

**Команды:**
```bash
ssh housler-server
cd /root/lk-housler

# Обновить .env с новыми секретами
nano .env

# Перезапустить
docker compose -f docker-compose.prod.yml up -d --force-recreate backend

# Проверить
docker logs lk-backend --tail 50
```

---

## Текущий статус проекта

| Компонент | Статус |
|-----------|--------|
| Auth (телефон+код) | ✅ Работает |
| Auth (email тестовые) | ✅ Работает |
| Регистрация риелтора | ❌ Не работает (BUG-003) |
| Сделки | ⏸️ Не протестировано (заблокировано BUG-003) |
| Backend | ✅ Работает |
| DB (shared) | ✅ Работает |

---

## Матрица назначений

| Задача | Исполнитель | Приоритет | Сложность |
|--------|-------------|-----------|-----------|
| BUG-003 | FE-LK | HIGH | M (2-4 часа) |
| BUG-002 | BE-LK + BE-AGENT | LOW | S (30 мин) |
| SEC-001 sync | INFRA (lk) | BLOCKER | S (15 мин) |

---

## Координация

**Срочно для FE-LK:**
- BUG-003 блокирует тестирование сделок

**Связаться с TPM agent.housler.ru по:**
1. BUG-002 — тестовые SMS коды (низкий приоритет, есть workaround)
2. SEC-001 — получить новые секреты после ротации

---

## Результаты теста 2026-01-16

**Что работает:**
- Авторизация по телефону (SMS код)
- Авторизация по email (тестовые `*@test.housler.ru`)
- Форма заполнения данных риелтора отображается
- Все поля валидируются корректно

**Что не работает:**
- Отправка формы регистрации (BUG-003)
- Переход в личный кабинет
- Тестирование сделок заблокировано

---

*Создано: 2026-01-16*
*Обновлено: 2026-01-16 после повторного мануального тестирования*
