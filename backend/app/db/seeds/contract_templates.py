"""Сидовые данные для шаблонов договоров

Bank-Led Safe Deal Architecture (Phase 6):
Шаблоны адаптированы под модель T-Bank Multiracchety:
- Оплата через номинальный счёт T-Bank
- Hold period до подтверждения услуги
- Возврат при споре

Шаблоны договоров согласно CONTRACT_SCENARIOS.md:
- TPL-000: Пользовательское соглашение (platform layer)
- TPL-001: Договор оказания услуг (покупка)
- TPL-002: Договор оказания услуг (продажа)
- TPL-003: Договор оказания услуг (аренда)
- TPL-004: Эксклюзивный договор
- TPL-005: Соглашение о разделе комиссии
- TPL-006: Агентский договор (агентство-агент)
"""

from datetime import date
from typing import List, Dict, Any

from app.models.document import TemplateType, TemplateStatus, ContractLayer


# Общая схема плейсхолдеров
# Bank-led модель: добавлены поля для hold period и механизма оплаты через T-Bank
COMMON_PLACEHOLDERS = {
    "type": "object",
    "required": ["agent_name", "client_name", "property_address", "commission_amount"],
    "properties": {
        "contract_number": {"type": "string", "description": "Номер договора"},
        "contract_date": {"type": "string", "format": "date", "description": "Дата договора"},
        "agent_name": {"type": "string", "description": "ФИО агента"},
        "agent_inn": {"type": "string", "description": "ИНН агента"},
        "agent_phone": {"type": "string", "description": "Телефон агента"},
        "agent_email": {"type": "string", "description": "Email агента"},
        "client_name": {"type": "string", "description": "ФИО клиента"},
        "client_phone": {"type": "string", "description": "Телефон клиента"},
        "client_passport": {"type": "string", "description": "Паспортные данные клиента"},
        "property_address": {"type": "string", "description": "Адрес объекта"},
        "property_price": {"type": "number", "description": "Стоимость объекта"},
        "commission_amount": {"type": "number", "description": "Сумма комиссии"},
        "commission_percent": {"type": "number", "description": "Процент комиссии"},
        "platform_fee": {"type": "number", "description": "Комиссия платформы"},
        "advance_amount": {"type": "number", "description": "Сумма аванса"},
        # Bank-led специфичные поля
        "hold_period_hours": {"type": "integer", "description": "Hold period в часах (по умолчанию 24)"},
        "payment_bank": {"type": "string", "description": "Банк-партнёр (T-Bank)", "default": "T-Bank"},
    }
}


# Шаблон TPL-001: Покупка
TPL_001_BUY = """
<div class="contract">
<h1>ДОГОВОР ОКАЗАНИЯ УСЛУГ</h1>
<p class="contract-number">№ {{contract_number}} от {{contract_date}}</p>

<p><strong>{{agent_name}}</strong>, ИНН {{agent_inn}}, именуемый в дальнейшем «Исполнитель», с одной стороны, и</p>
<p><strong>{{client_name}}</strong>, именуемый в дальнейшем «Заказчик», с другой стороны,</p>
<p>совместно именуемые «Стороны», заключили настоящий Договор о нижеследующем:</p>

<h2>1. ПРЕДМЕТ ДОГОВОРА</h2>
<p>1.1. Исполнитель обязуется оказать Заказчику услуги по подбору объекта недвижимости для приобретения, а Заказчик обязуется оплатить данные услуги.</p>
<p>1.2. Под объектом недвижимости понимается: {{property_address}}.</p>
<p>1.3. Планируемая стоимость объекта: {{property_price}} рублей.</p>

<h2>2. СТОИМОСТЬ УСЛУГ И ПОРЯДОК ОПЛАТЫ</h2>
<p>2.1. Стоимость услуг Исполнителя составляет: {{commission_amount}} рублей{% if commission_percent %} ({{commission_percent}}% от стоимости объекта){% endif %}.</p>
{% if advance_amount > 0 %}
<p>2.2. Аванс в размере {{advance_amount}} рублей оплачивается в течение 3 рабочих дней с момента подписания настоящего Договора.</p>
<p>2.3. Оставшаяся сумма оплачивается в момент регистрации перехода права собственности.</p>
{% else %}
<p>2.2. Оплата производится в полном объёме в момент регистрации перехода права собственности на объект.</p>
{% endif %}

<h2>2А. МЕХАНИЗМ БЕЗОПАСНОЙ ОПЛАТЫ</h2>
<p>2А.1. Оплата услуг Исполнителя осуществляется через номинальный счёт банка-партнёра ({{payment_bank|default("T-Bank")}}) в соответствии с условиями безопасной сделки платформы Housler.</p>
<p>2А.2. После поступления оплаты от Заказчика денежные средства удерживаются на номинальном счёте банка в течение hold period ({{hold_period_hours|default(24)}} часов) до подтверждения оказания услуги Заказчиком.</p>
<p>2А.3. Выплата Исполнителю производится после:</p>
<ul>
<li>Подтверждения оказания услуги Заказчиком; или</li>
<li>Автоматически по истечении hold period при отсутствии спора.</li>
</ul>
<p>2А.4. В случае открытия спора Заказчиком в течение hold period денежные средства замораживаются до разрешения спора.</p>
<p>2А.5. При разрешении спора в пользу Заказчика денежные средства возвращаются Заказчику в полном объёме.</p>

<h2>3. ПРАВА И ОБЯЗАННОСТИ СТОРОН</h2>
<p>3.1. Исполнитель обязуется:</p>
<ul>
<li>Подобрать объекты недвижимости согласно требованиям Заказчика;</li>
<li>Организовать просмотры объектов;</li>
<li>Проверить юридическую чистоту объекта;</li>
<li>Сопроводить сделку до регистрации права собственности.</li>
</ul>
<p>3.2. Заказчик обязуется:</p>
<ul>
<li>Предоставить достоверную информацию о требованиях к объекту;</li>
<li>Своевременно оплатить услуги Исполнителя;</li>
<li>Не вступать в прямые переговоры с продавцами объектов, показанных Исполнителем.</li>
</ul>

<h2>4. ОТВЕТСТВЕННОСТЬ СТОРОН</h2>
<p>4.1. За неисполнение или ненадлежащее исполнение обязательств по настоящему Договору Стороны несут ответственность в соответствии с законодательством Российской Федерации.</p>

<h2>5. РАЗРЕШЕНИЕ СПОРОВ</h2>
<p>5.1. Все споры, возникающие из настоящего Договора, разрешаются путём переговоров.</p>
<p>5.2. При невозможности достижения согласия спор передаётся на рассмотрение в суд по месту нахождения ответчика.</p>

<h2>6. СРОК ДЕЙСТВИЯ ДОГОВОРА</h2>
<p>6.1. Договор вступает в силу с момента подписания и действует до полного исполнения сторонами своих обязательств.</p>

<h2>7. РЕКВИЗИТЫ И ПОДПИСИ СТОРОН</h2>
<div class="signatures">
<div class="signature-block">
<p><strong>Исполнитель:</strong></p>
<p>{{agent_name}}</p>
<p>ИНН: {{agent_inn}}</p>
<p>Тел: {{agent_phone}}</p>
<p class="signature-line">___________________ / {{agent_name}} /</p>
</div>
<div class="signature-block">
<p><strong>Заказчик:</strong></p>
<p>{{client_name}}</p>
<p>Тел: {{client_phone}}</p>
<p class="signature-line">___________________ / {{client_name}} /</p>
</div>
</div>
</div>
"""

# Шаблон TPL-002: Продажа
TPL_002_SELL = """
<div class="contract">
<h1>ДОГОВОР ОКАЗАНИЯ УСЛУГ</h1>
<p class="contract-number">№ {{contract_number}} от {{contract_date}}</p>

<p><strong>{{agent_name}}</strong>, ИНН {{agent_inn}}, именуемый в дальнейшем «Исполнитель», с одной стороны, и</p>
<p><strong>{{client_name}}</strong>, именуемый в дальнейшем «Заказчик», с другой стороны,</p>
<p>совместно именуемые «Стороны», заключили настоящий Договор о нижеследующем:</p>

<h2>1. ПРЕДМЕТ ДОГОВОРА</h2>
<p>1.1. Исполнитель обязуется оказать Заказчику услуги по продаже объекта недвижимости, а Заказчик обязуется оплатить данные услуги.</p>
<p>1.2. Объект недвижимости: {{property_address}}.</p>
<p>1.3. Ожидаемая стоимость продажи: {{property_price}} рублей.</p>

<h2>2. СТОИМОСТЬ УСЛУГ И ПОРЯДОК ОПЛАТЫ</h2>
<p>2.1. Стоимость услуг Исполнителя составляет: {{commission_amount}} рублей{% if commission_percent %} ({{commission_percent}}% от цены продажи){% endif %}.</p>
{% if advance_amount > 0 %}
<p>2.2. Аванс в размере {{advance_amount}} рублей (на маркетинг и продвижение) оплачивается в течение 3 рабочих дней с момента подписания настоящего Договора.</p>
<p>2.3. Оставшаяся сумма оплачивается в момент получения Заказчиком денежных средств от покупателя.</p>
{% else %}
<p>2.2. Оплата производится в полном объёме в момент получения Заказчиком денежных средств от покупателя.</p>
{% endif %}

<h2>2А. МЕХАНИЗМ БЕЗОПАСНОЙ ОПЛАТЫ</h2>
<p>2А.1. Оплата услуг Исполнителя осуществляется через номинальный счёт банка-партнёра ({{payment_bank|default("T-Bank")}}) в соответствии с условиями безопасной сделки платформы Housler.</p>
<p>2А.2. После поступления оплаты от Заказчика денежные средства удерживаются на номинальном счёте банка в течение hold period ({{hold_period_hours|default(24)}} часов) до подтверждения оказания услуги Заказчиком.</p>
<p>2А.3. Выплата Исполнителю производится после подтверждения оказания услуги Заказчиком или автоматически по истечении hold period при отсутствии спора.</p>
<p>2А.4. В случае открытия спора денежные средства замораживаются до его разрешения. При разрешении спора в пользу Заказчика средства возвращаются Заказчику.</p>

<h2>3. ПРАВА И ОБЯЗАННОСТИ СТОРОН</h2>
<p>3.1. Исполнитель обязуется:</p>
<ul>
<li>Провести оценку рыночной стоимости объекта;</li>
<li>Организовать рекламную кампанию объекта;</li>
<li>Проводить показы потенциальным покупателям;</li>
<li>Вести переговоры с покупателями;</li>
<li>Подготовить документы для сделки;</li>
<li>Сопроводить сделку до регистрации перехода права собственности.</li>
</ul>
<p>3.2. Заказчик обязуется:</p>
<ul>
<li>Предоставить доступ к объекту для показов;</li>
<li>Предоставить все необходимые документы на объект;</li>
<li>Своевременно оплатить услуги Исполнителя.</li>
</ul>

<h2>4. ОТВЕТСТВЕННОСТЬ СТОРОН</h2>
<p>4.1. За неисполнение или ненадлежащее исполнение обязательств по настоящему Договору Стороны несут ответственность в соответствии с законодательством РФ.</p>

<h2>5. РАЗРЕШЕНИЕ СПОРОВ</h2>
<p>5.1. Все споры разрешаются путём переговоров. При недостижении согласия — в судебном порядке.</p>

<h2>6. СРОК ДЕЙСТВИЯ ДОГОВОРА</h2>
<p>6.1. Договор действует до полного исполнения сторонами своих обязательств.</p>

<h2>7. РЕКВИЗИТЫ И ПОДПИСИ СТОРОН</h2>
<div class="signatures">
<div class="signature-block">
<p><strong>Исполнитель:</strong></p>
<p>{{agent_name}}</p>
<p>ИНН: {{agent_inn}}</p>
<p class="signature-line">___________________ / {{agent_name}} /</p>
</div>
<div class="signature-block">
<p><strong>Заказчик:</strong></p>
<p>{{client_name}}</p>
<p class="signature-line">___________________ / {{client_name}} /</p>
</div>
</div>
</div>
"""

# Шаблон TPL-003: Аренда
TPL_003_RENT = """
<div class="contract">
<h1>ДОГОВОР ОКАЗАНИЯ УСЛУГ</h1>
<p class="contract-number">№ {{contract_number}} от {{contract_date}}</p>

<p><strong>{{agent_name}}</strong>, ИНН {{agent_inn}}, именуемый в дальнейшем «Исполнитель», с одной стороны, и</p>
<p><strong>{{client_name}}</strong>, именуемый в дальнейшем «Заказчик», с другой стороны,</p>
<p>совместно именуемые «Стороны», заключили настоящий Договор о нижеследующем:</p>

<h2>1. ПРЕДМЕТ ДОГОВОРА</h2>
<p>1.1. Исполнитель обязуется оказать Заказчику услуги по поиску/сдаче в аренду объекта недвижимости.</p>
<p>1.2. Объект недвижимости: {{property_address}}.</p>
<p>1.3. Ориентировочная арендная плата: {{property_price}} рублей в месяц.</p>

<h2>2. СТОИМОСТЬ УСЛУГ И ПОРЯДОК ОПЛАТЫ</h2>
<p>2.1. Стоимость услуг Исполнителя составляет: {{commission_amount}} рублей.</p>
<p>2.2. Оплата производится в момент подписания договора аренды между сторонами.</p>

<h2>2А. МЕХАНИЗМ БЕЗОПАСНОЙ ОПЛАТЫ</h2>
<p>2А.1. Оплата услуг осуществляется через номинальный счёт банка-партнёра ({{payment_bank|default("T-Bank")}}) платформы Housler.</p>
<p>2А.2. Денежные средства удерживаются на номинальном счёте банка в течение hold period ({{hold_period_hours|default(24)}} часов) до подтверждения услуги.</p>
<p>2А.3. Выплата производится после подтверждения услуги или автоматически по истечении hold period.</p>
<p>2А.4. При споре средства замораживаются до разрешения. При решении в пользу Заказчика - возврат.</p>

<h2>3. ПРАВА И ОБЯЗАННОСТИ СТОРОН</h2>
<p>3.1. Исполнитель обязуется:</p>
<ul>
<li>Подобрать объекты/арендаторов согласно требованиям Заказчика;</li>
<li>Организовать показы;</li>
<li>Проверить документы контрагента;</li>
<li>Подготовить договор аренды.</li>
</ul>
<p>3.2. Заказчик обязуется своевременно оплатить услуги Исполнителя.</p>

<h2>4. СРОК ДЕЙСТВИЯ ДОГОВОРА</h2>
<p>4.1. Договор действует 60 календарных дней с момента подписания.</p>

<h2>5. РЕКВИЗИТЫ И ПОДПИСИ СТОРОН</h2>
<div class="signatures">
<div class="signature-block">
<p><strong>Исполнитель:</strong> {{agent_name}}</p>
<p class="signature-line">___________________</p>
</div>
<div class="signature-block">
<p><strong>Заказчик:</strong> {{client_name}}</p>
<p class="signature-line">___________________</p>
</div>
</div>
</div>
"""

# Шаблон TPL-004: Эксклюзив
TPL_004_EXCLUSIVE = """
<div class="contract">
<h1>ЭКСКЛЮЗИВНЫЙ ДОГОВОР ОКАЗАНИЯ УСЛУГ</h1>
<p class="contract-number">№ {{contract_number}} от {{contract_date}}</p>

<p><strong>{{agent_name}}</strong>, ИНН {{agent_inn}}, именуемый в дальнейшем «Исполнитель», с одной стороны, и</p>
<p><strong>{{client_name}}</strong>, именуемый в дальнейшем «Заказчик», с другой стороны,</p>
<p>совместно именуемые «Стороны», заключили настоящий Эксклюзивный договор:</p>

<h2>1. ПРЕДМЕТ ДОГОВОРА</h2>
<p>1.1. Заказчик предоставляет Исполнителю ИСКЛЮЧИТЕЛЬНОЕ право на реализацию объекта недвижимости.</p>
<p>1.2. Объект недвижимости: {{property_address}}.</p>
<p>1.3. Ожидаемая стоимость: {{property_price}} рублей.</p>

<h2>2. ЭКСКЛЮЗИВНОСТЬ</h2>
<p>2.1. В течение срока действия настоящего Договора Заказчик обязуется:</p>
<ul>
<li>Не заключать аналогичные договоры с другими агентами;</li>
<li>Не продавать объект самостоятельно;</li>
<li>Направлять всех обратившихся покупателей к Исполнителю.</li>
</ul>
<p>2.2. В случае нарушения эксклюзивности Заказчик выплачивает Исполнителю штраф в размере {{commission_amount}} рублей.</p>

<h2>3. СТОИМОСТЬ УСЛУГ</h2>
<p>3.1. Стоимость услуг: {{commission_amount}} рублей{% if commission_percent %} ({{commission_percent}}% от цены продажи){% endif %}.</p>
{% if advance_amount > 0 %}
<p>3.2. Аванс на маркетинг: {{advance_amount}} рублей.</p>
{% endif %}

<h2>3А. МЕХАНИЗМ БЕЗОПАСНОЙ ОПЛАТЫ</h2>
<p>3А.1. Оплата услуг Исполнителя осуществляется через номинальный счёт банка-партнёра ({{payment_bank|default("T-Bank")}}) платформы Housler.</p>
<p>3А.2. Денежные средства удерживаются на номинальном счёте банка в течение hold period ({{hold_period_hours|default(24)}} часов) до подтверждения оказания услуги.</p>
<p>3А.3. Выплата Исполнителю производится после подтверждения услуги Заказчиком или автоматически по истечении hold period при отсутствии спора.</p>
<p>3А.4. В случае спора средства замораживаются до разрешения. При решении в пользу Заказчика - полный возврат.</p>

<h2>4. ОБЯЗАННОСТИ ИСПОЛНИТЕЛЯ</h2>
<p>4.1. Исполнитель обязуется:</p>
<ul>
<li>Провести профессиональную фотосъёмку объекта;</li>
<li>Разместить объект на всех ведущих площадках;</li>
<li>Организовать не менее 10 показов в месяц;</li>
<li>Предоставлять еженедельный отчёт о работе.</li>
</ul>

<h2>5. СРОК ДЕЙСТВИЯ</h2>
<p>5.1. Договор действует с {{contract_date}} по {{exclusive_until}}.</p>
<p>5.2. Договор может быть продлён по соглашению сторон.</p>

<h2>6. РЕКВИЗИТЫ И ПОДПИСИ СТОРОН</h2>
<div class="signatures">
<div class="signature-block">
<p><strong>Исполнитель:</strong> {{agent_name}}</p>
<p class="signature-line">___________________</p>
</div>
<div class="signature-block">
<p><strong>Заказчик:</strong> {{client_name}}</p>
<p class="signature-line">___________________</p>
</div>
</div>
</div>
"""

# Шаблон TPL-005: Со-агент
TPL_005_COAGENT = """
<div class="contract">
<h1>СОГЛАШЕНИЕ О РАЗДЕЛЕ КОМИССИИ</h1>
<p class="contract-number">№ {{contract_number}} от {{contract_date}}</p>

<p><strong>{{agent_name}}</strong>, именуемый в дальнейшем «Агент 1», с одной стороны, и</p>
<p><strong>{{coagent_name}}</strong>, именуемый в дальнейшем «Агент 2», с другой стороны,</p>
<p>заключили настоящее Соглашение:</p>

<h2>1. ПРЕДМЕТ СОГЛАШЕНИЯ</h2>
<p>1.1. Стороны договариваются о совместной работе по сделке:</p>
<p>Объект: {{property_address}}</p>
<p>Стоимость: {{property_price}} рублей</p>
<p>Общая комиссия: {{commission_amount}} рублей</p>

<h2>2. РАСПРЕДЕЛЕНИЕ КОМИССИИ</h2>
<p>2.1. Комиссия распределяется следующим образом:</p>
<ul>
<li>Агент 1: {{agent_split_percent}}% ({{agent_split_amount}} рублей)</li>
<li>Агент 2: {{coagent_split_percent}}% ({{coagent_split_amount}} рублей)</li>
</ul>
<p>2.2. Выплата производится автоматически через номинальный счёт банка-партнёра ({{payment_bank|default("T-Bank")}}) платформы Housler после подтверждения услуги клиентом.</p>

<h2>2А. МЕХАНИЗМ БЕЗОПАСНОЙ ОПЛАТЫ</h2>
<p>2А.1. После оплаты клиентом денежные средства поступают на номинальный счёт банка-партнёра.</p>
<p>2А.2. Средства удерживаются в течение hold period ({{hold_period_hours|default(24)}} часов) до подтверждения услуги.</p>
<p>2А.3. После подтверждения услуги (или автоматически по истечении hold period) средства распределяются между Агентом 1 и Агентом 2 согласно п. 2.1.</p>
<p>2А.4. В случае спора с клиентом средства замораживаются до разрешения спора. Распределение происходит после разрешения.</p>

<h2>3. ОБЯЗАННОСТИ СТОРОН</h2>
<p>3.1. Агент 1 (представляет покупателя/арендатора):</p>
<ul><li>Сопровождает своего клиента на сделке;</li><li>Несёт ответственность за платёжеспособность клиента.</li></ul>
<p>3.2. Агент 2 (представляет продавца/арендодателя):</p>
<ul><li>Сопровождает своего клиента;</li><li>Гарантирует юридическую чистоту объекта.</li></ul>

<h2>4. КОНФИДЕНЦИАЛЬНОСТЬ</h2>
<p>4.1. Стороны обязуются не разглашать условия настоящего Соглашения третьим лицам.</p>

<h2>5. ПОДПИСИ СТОРОН</h2>
<div class="signatures">
<div class="signature-block">
<p><strong>Агент 1:</strong> {{agent_name}}</p>
<p>Телефон: {{agent_phone}}</p>
<p class="signature-line">___________________</p>
</div>
<div class="signature-block">
<p><strong>Агент 2:</strong> {{coagent_name}}</p>
<p>Телефон: {{coagent_phone}}</p>
<p class="signature-line">___________________</p>
</div>
</div>
</div>
"""

# Шаблон Platform Layer: Пользовательское соглашение (Terms of Service)
TPL_USER_AGREEMENT = """
<div class="contract">
<h1>ПОЛЬЗОВАТЕЛЬСКОЕ СОГЛАШЕНИЕ</h1>
<p class="contract-subtitle">Платформа Housler</p>
<p class="contract-date">Редакция от {{effective_date}}</p>

<h2>1. ОБЩИЕ ПОЛОЖЕНИЯ</h2>
<p>1.1. Настоящее Пользовательское соглашение (далее - «Соглашение») регулирует отношения между ООО «Хауслер» (далее - «Платформа») и пользователем (далее - «Пользователь») при использовании сервиса lk.housler.ru.</p>
<p>1.2. Регистрация на Платформе означает полное и безоговорочное принятие настоящего Соглашения.</p>

<h2>2. ПРЕДМЕТ СОГЛАШЕНИЯ</h2>
<p>2.1. Платформа предоставляет Пользователю доступ к сервису безопасных сделок с недвижимостью, включая:</p>
<ul>
<li>Создание и управление сделками;</li>
<li>Электронное подписание договоров;</li>
<li>Безопасное проведение расчётов через банк-партнёр;</li>
<li>Разрешение споров между участниками сделок.</li>
</ul>

<h2>3. ПРАВА И ОБЯЗАННОСТИ ПОЛЬЗОВАТЕЛЯ</h2>
<p>3.1. Пользователь обязуется:</p>
<ul>
<li>Предоставлять достоверную информацию при регистрации;</li>
<li>Соблюдать законодательство РФ при использовании Платформы;</li>
<li>Не использовать Платформу для противоправных целей;</li>
<li>Самостоятельно обеспечивать безопасность учётной записи.</li>
</ul>
<p>3.2. Пользователь имеет право:</p>
<ul>
<li>Использовать функционал Платформы в соответствии с тарифами;</li>
<li>Обращаться в службу поддержки по вопросам работы сервиса;</li>
<li>Удалить учётную запись в любое время.</li>
</ul>

<h2>4. ПРАВА И ОБЯЗАННОСТИ ПЛАТФОРМЫ</h2>
<p>4.1. Платформа обязуется:</p>
<ul>
<li>Обеспечивать работоспособность сервиса;</li>
<li>Защищать персональные данные Пользователя;</li>
<li>Уведомлять о существенных изменениях в работе сервиса.</li>
</ul>
<p>4.2. Платформа имеет право:</p>
<ul>
<li>Вносить изменения в функционал сервиса;</li>
<li>Приостановить доступ при нарушении Соглашения;</li>
<li>Изменять тарифы с уведомлением за 30 дней.</li>
</ul>

<h2>5. ФИНАНСОВЫЕ УСЛОВИЯ</h2>
<p>5.1. Комиссия Платформы за проведение сделки составляет {{platform_fee_percent}}% от суммы комиссии агента, но не менее {{platform_fee_min}} рублей.</p>
<p>5.2. Комиссия удерживается автоматически при распределении средств через номинальный счёт банка-партнёра (T-Bank).</p>

<h2>5А. МЕХАНИЗМ БЕЗОПАСНОЙ СДЕЛКИ</h2>
<p>5А.1. Платформа обеспечивает проведение безопасных расчётов через номинальный счёт банка-партнёра T-Bank.</p>
<p>5А.2. Механизм работы:</p>
<ul>
<li>Клиент оплачивает услуги агента через платёжную страницу Платформы;</li>
<li>Денежные средства поступают на номинальный счёт банка T-Bank;</li>
<li>Средства удерживаются в течение hold period (настраиваемый, по умолчанию 24 часа);</li>
<li>После подтверждения услуги клиентом (или автоматически по истечении hold period) средства распределяются между участниками.</li>
</ul>
<p>5А.3. В случае спора:</p>
<ul>
<li>Клиент может открыть спор в течение hold period;</li>
<li>Денежные средства замораживаются до разрешения спора;</li>
<li>При разрешении спора в пользу клиента - полный возврат средств;</li>
<li>При разрешении в пользу исполнителя - выплата исполнителю.</li>
</ul>
<p>5А.4. Платформа не является стороной договора оказания услуг между агентом и клиентом, а лишь обеспечивает техническую возможность безопасных расчётов.</p>

<h2>6. ОГРАНИЧЕНИЕ ОТВЕТСТВЕННОСТИ</h2>
<p>6.1. Платформа не несёт ответственности за:</p>
<ul>
<li>Действия третьих лиц (агентов, клиентов, банков);</li>
<li>Качество услуг, оказываемых агентами;</li>
<li>Технические сбои по независящим от Платформы причинам.</li>
</ul>

<h2>7. ОБРАБОТКА ПЕРСОНАЛЬНЫХ ДАННЫХ</h2>
<p>7.1. Пользователь даёт согласие на обработку персональных данных в соответствии с Федеральным законом № 152-ФЗ.</p>
<p>7.2. Политика конфиденциальности размещена на сайте housler.ru/privacy.</p>

<h2>8. РАЗРЕШЕНИЕ СПОРОВ</h2>
<p>8.1. Споры разрешаются путём переговоров.</p>
<p>8.2. При недостижении согласия спор передаётся в суд по месту нахождения Платформы (г. Москва).</p>

<h2>9. ЗАКЛЮЧИТЕЛЬНЫЕ ПОЛОЖЕНИЯ</h2>
<p>9.1. Соглашение вступает в силу с момента регистрации и действует бессрочно.</p>
<p>9.2. Платформа вправе изменять Соглашение с уведомлением Пользователей за 14 дней.</p>

<div class="footer">
<p>ООО «Хауслер»</p>
<p>ИНН: XXXXXXXXXX, ОГРН: XXXXXXXXXXXXX</p>
<p>Адрес: г. Москва</p>
</div>
</div>
"""


# Шаблон TPL-006: Агентство-Агент
TPL_006_AGENCY_AGENT = """
<div class="contract">
<h1>АГЕНТСКИЙ ДОГОВОР</h1>
<p class="contract-number">№ {{contract_number}} от {{contract_date}}</p>

<p><strong>{{agency_name}}</strong>, ИНН {{agency_inn}}, в лице {{agency_director}}, именуемое в дальнейшем «Агентство», с одной стороны, и</p>
<p><strong>{{agent_name}}</strong>, ИНН {{agent_inn}}, именуемый в дальнейшем «Агент», с другой стороны,</p>
<p>заключили настоящий Договор:</p>

<h2>1. ПРЕДМЕТ ДОГОВОРА</h2>
<p>1.1. Агентство поручает, а Агент принимает на себя обязательства по оказанию риэлторских услуг от имени Агентства.</p>

<h2>2. РАСПРЕДЕЛЕНИЕ ДОХОДА</h2>
<p>2.1. Комиссия по сделкам распределяется:</p>
<ul>
<li>Агент: {{agent_split_percent}}%</li>
<li>Агентство: {{agency_split_percent}}%</li>
</ul>
<p>2.2. Выплаты производятся автоматически через номинальный счёт банка-партнёра ({{payment_bank|default("T-Bank")}}) платформы Housler после подтверждения услуги клиентом.</p>

<h2>2А. МЕХАНИЗМ БЕЗОПАСНОЙ ОПЛАТЫ</h2>
<p>2А.1. После оплаты клиентом денежные средства поступают на номинальный счёт банка-партнёра.</p>
<p>2А.2. Средства удерживаются в течение hold period до подтверждения услуги клиентом.</p>
<p>2А.3. После подтверждения услуги средства автоматически распределяются между Агентом и Агентством согласно п. 2.1.</p>
<p>2А.4. При споре с клиентом средства замораживаются до разрешения.</p>

<h2>3. ОБЯЗАННОСТИ АГЕНТСТВА</h2>
<ul>
<li>Предоставлять доступ к CRM-системе и базе объектов;</li>
<li>Обеспечивать юридическую поддержку;</li>
<li>Своевременно выплачивать вознаграждение Агенту.</li>
</ul>

<h2>4. ОБЯЗАННОСТИ АГЕНТА</h2>
<ul>
<li>Соблюдать стандарты работы Агентства;</li>
<li>Вносить информацию о сделках в CRM;</li>
<li>Не переманивать клиентов Агентства.</li>
</ul>

<h2>5. СРОК ДЕЙСТВИЯ</h2>
<p>5.1. Договор заключён на неопределённый срок.</p>
<p>5.2. Каждая сторона вправе расторгнуть Договор, уведомив другую сторону за 30 дней.</p>

<h2>6. РЕКВИЗИТЫ И ПОДПИСИ СТОРОН</h2>
<div class="signatures">
<div class="signature-block">
<p><strong>Агентство:</strong></p>
<p>{{agency_name}}</p>
<p>ИНН: {{agency_inn}}</p>
<p class="signature-line">___________________</p>
</div>
<div class="signature-block">
<p><strong>Агент:</strong></p>
<p>{{agent_name}}</p>
<p>ИНН: {{agent_inn}}</p>
<p class="signature-line">___________________</p>
</div>
</div>
</div>
"""


def get_contract_templates() -> List[Dict[str, Any]]:
    """Возвращает список шаблонов договоров для сидирования в БД

    Шаблоны разделены на два слоя:
    - PLATFORM: Договоры между пользователем и платформой Housler
    - TRANSACTION: Договоры между участниками сделки
    """
    return [
        # ============================================================
        # PLATFORM LAYER - Пользовательское соглашение с Housler
        # ============================================================
        {
            "code": "TPL-000",
            "type": TemplateType.USER_AGREEMENT.value,
            "version": "2.0",
            "name": "Пользовательское соглашение",
            "description": "Terms of Service - соглашение между пользователем и платформой Housler. v2.0: Bank-led модель (T-Bank, hold period, споры)",
            "layer": ContractLayer.PLATFORM.value,  # Platform layer
            "deal_types": [],  # Не привязан к типу сделки
            "party_types": [],  # Housler - User
            "template_body": TPL_USER_AGREEMENT,
            "placeholders_schema": {
                "type": "object",
                "properties": {
                    "effective_date": {"type": "string", "format": "date", "description": "Дата редакции"},
                    "platform_fee_percent": {"type": "number", "description": "Комиссия платформы (%)"},
                    "platform_fee_min": {"type": "number", "description": "Минимальная комиссия платформы"},
                }
            },
            "legal_basis": "ГК РФ Глава 39, 152-ФЗ (Персональные данные)",
            "effective_from": date(2026, 1, 1),
            "status": TemplateStatus.PUBLISHED.value,
            "active": True,
        },

        # ============================================================
        # TRANSACTION LAYER - Договоры между участниками сделок
        # ============================================================
        {
            "code": "TPL-001",
            "type": TemplateType.TPL_001_BUY.value,
            "version": "2.0",
            "name": "Договор оказания услуг (покупка)",
            "description": "Договор между агентом и клиентом-покупателем. v2.0: Оплата через T-Bank, hold period, возврат при споре",
            "layer": ContractLayer.TRANSACTION.value,  # Transaction layer
            "deal_types": ["sale_buy"],
            "party_types": ["agent_client"],
            "template_body": TPL_001_BUY,
            "placeholders_schema": COMMON_PLACEHOLDERS,
            "legal_basis": "ГК РФ Глава 39 (Возмездное оказание услуг)",
            "effective_from": date(2026, 1, 1),
            "status": TemplateStatus.PUBLISHED.value,
            "active": True,
        },
        {
            "code": "TPL-002",
            "type": TemplateType.TPL_002_SELL.value,
            "version": "2.0",
            "name": "Договор оказания услуг (продажа)",
            "description": "Договор между агентом и клиентом-продавцом. v2.0: Оплата через T-Bank, hold period, возврат при споре",
            "layer": ContractLayer.TRANSACTION.value,  # Transaction layer
            "deal_types": ["sale_sell"],
            "party_types": ["agent_client"],
            "template_body": TPL_002_SELL,
            "placeholders_schema": COMMON_PLACEHOLDERS,
            "legal_basis": "ГК РФ Глава 39 (Возмездное оказание услуг)",
            "effective_from": date(2026, 1, 1),
            "status": TemplateStatus.PUBLISHED.value,
            "active": True,
        },
        {
            "code": "TPL-003",
            "type": TemplateType.TPL_003_RENT.value,
            "version": "2.0",
            "name": "Договор оказания услуг (аренда)",
            "description": "Договор между агентом и клиентом по аренде. v2.0: Оплата через T-Bank, hold period, возврат при споре",
            "layer": ContractLayer.TRANSACTION.value,  # Transaction layer
            "deal_types": ["rent_tenant", "rent_landlord"],
            "party_types": ["agent_client"],
            "template_body": TPL_003_RENT,
            "placeholders_schema": COMMON_PLACEHOLDERS,
            "legal_basis": "ГК РФ Глава 39 (Возмездное оказание услуг)",
            "effective_from": date(2026, 1, 1),
            "status": TemplateStatus.PUBLISHED.value,
            "active": True,
        },
        {
            "code": "TPL-004",
            "type": TemplateType.TPL_004_EXCLUSIVE.value,
            "version": "2.0",
            "name": "Эксклюзивный договор",
            "description": "Эксклюзивный договор на продажу объекта. v2.0: Оплата через T-Bank, hold period, возврат при споре",
            "layer": ContractLayer.TRANSACTION.value,  # Transaction layer
            "deal_types": ["sale_sell"],
            "party_types": ["agent_client"],
            "template_body": TPL_004_EXCLUSIVE,
            "placeholders_schema": {
                **COMMON_PLACEHOLDERS,
                "properties": {
                    **COMMON_PLACEHOLDERS["properties"],
                    "exclusive_until": {"type": "string", "format": "date", "description": "Срок эксклюзива"},
                }
            },
            "legal_basis": "ГК РФ Глава 39, Глава 52 (Агентский договор)",
            "effective_from": date(2026, 1, 1),
            "status": TemplateStatus.PUBLISHED.value,
            "active": True,
        },
        {
            "code": "TPL-005",
            "type": TemplateType.TPL_005_COAGENT.value,
            "version": "2.0",
            "name": "Соглашение о разделе комиссии",
            "description": "Соглашение между двумя агентами о разделе комиссии. v2.0: Автораспределение через T-Bank после hold period",
            "layer": ContractLayer.TRANSACTION.value,  # Transaction layer
            "deal_types": ["sale_buy", "sale_sell", "rent_tenant", "rent_landlord"],
            "party_types": ["agent_agent"],
            "template_body": TPL_005_COAGENT,
            "placeholders_schema": {
                "type": "object",
                "required": ["agent_name", "coagent_name", "property_address", "commission_amount"],
                "properties": {
                    **COMMON_PLACEHOLDERS["properties"],
                    "coagent_name": {"type": "string", "description": "ФИО со-агента"},
                    "coagent_phone": {"type": "string", "description": "Телефон со-агента"},
                    "agent_split_percent": {"type": "number", "description": "Доля агента 1 (%)"},
                    "agent_split_amount": {"type": "number", "description": "Сумма агента 1"},
                    "coagent_split_percent": {"type": "number", "description": "Доля агента 2 (%)"},
                    "coagent_split_amount": {"type": "number", "description": "Сумма агента 2"},
                }
            },
            "legal_basis": "ГК РФ Глава 27 (Понятие и условия договора)",
            "effective_from": date(2026, 1, 1),
            "status": TemplateStatus.PUBLISHED.value,
            "active": True,
        },
        {
            "code": "TPL-006",
            "type": TemplateType.TPL_006_AGENCY_AGENT.value,
            "version": "2.0",
            "name": "Агентский договор (агентство-агент)",
            "description": "Внутренний договор между агентством и агентом. v2.0: Автораспределение через T-Bank после hold period",
            "layer": ContractLayer.TRANSACTION.value,  # Transaction layer
            "deal_types": [],  # Не привязан к типу сделки
            "party_types": ["agency_agent"],
            "template_body": TPL_006_AGENCY_AGENT,
            "placeholders_schema": {
                "type": "object",
                "required": ["agency_name", "agent_name"],
                "properties": {
                    "contract_number": {"type": "string"},
                    "contract_date": {"type": "string", "format": "date"},
                    "agency_name": {"type": "string", "description": "Название агентства"},
                    "agency_inn": {"type": "string", "description": "ИНН агентства"},
                    "agency_director": {"type": "string", "description": "Директор агентства"},
                    "agent_name": {"type": "string", "description": "ФИО агента"},
                    "agent_inn": {"type": "string", "description": "ИНН агента"},
                    "agent_split_percent": {"type": "number", "description": "Доля агента (%)"},
                    "agency_split_percent": {"type": "number", "description": "Доля агентства (%)"},
                }
            },
            "legal_basis": "ГК РФ Глава 52 (Агентирование)",
            "effective_from": date(2026, 1, 1),
            "status": TemplateStatus.PUBLISHED.value,
            "active": True,
        },
    ]
